name: Main Build Job

on: push

jobs:
  pars-vars:
    environment: 
      name: dev
    runs-on: ubuntu-latest
    outputs:
      variables: ${{ steps.pars-vars.outputs.json }}
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      - name: Set Variables
        uses: ./.github/actions/parse-vars
        id: pars-vars
        with:
          path: ".github/variables/myvars.env"
          log-variables: true
      - name: Using Variables
        run: |
          echo "The configuration name from the previous step is ${{ steps.pars-vars.outputs.configurationname }}"
          echo "The environment from the previous step is ${{ steps.pars-vars.outputs.environment }}"
          echo "The builds defined from the previous step are ${{ steps.pars-vars.outputs.builds }}"
  secondary-build:
    environment:
      name: test
    runs-on: ubuntu-latest
    needs: [pars-vars]
    name: building Unrelated to matrix
    steps:
      - name: Test Variables
        run: |
          echo "The builds defined from the previous job are ${{ fromJSON(needs.pars-vars.outputs.variables).Builds }}"
  downstream-job:
    needs: [pars-vars, secondary-build]
    runs-on: ubuntu-latest
    name: Downstream Job
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      - name: Test Variables
        run: |
          echo "The builds defined from the previous job are ${{ toJSON(fromJSON(needs.pars-vars.outputs.variables).Builds) }}"
